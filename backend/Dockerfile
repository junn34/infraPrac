# ---------- 1ë‹¨ê³„: Build ----------
FROM gradle:8.8-jdk17 AS build
WORKDIR /workspace

# í”„ë¡œì íŠ¸ ì „ì²´ ë³µì‚¬
COPY bankedu-back /workspace

# ë¹Œë“œ
RUN gradle clean build -x test --no-daemon

# ---------- 2ë‹¨ê³„: Run ----------
FROM eclipse-temurin:17-jdk-alpine
WORKDIR /app

# ğŸ”¥ Jenkins build args ë°›ê¸°
ARG DB_HOST
ARG DB_USERNAME
ARG DB_PASSWORD

# ğŸ”¥ Spring Bootê°€ ì½ë„ë¡ ENVë¡œ ë“±ë¡
ENV DB_HOST=$DB_HOST
ENV DB_USERNAME=$DB_USERNAME
ENV DB_PASSWORD=$DB_PASSWORD

# ë¹Œë“œëœ JAR ë³µì‚¬
COPY --from=build /workspace/build/libs/bankedu-back-0.0.1-SNAPSHOT.jar app.jar

EXPOSE 8080
ENTRYPOINT ["java", "-jar", "app.jar"]

